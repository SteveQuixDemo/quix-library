FROM quixpythonbaseimagewithopencv

# RUN apt-get update && apt-get install -y cmake git libopenjp2-tools libgtk2.0-dev pkg-config libavcodec-dev \
#   libavformat-dev libswscale-dev
# RUN  apt-get install -y python3-dev python3-numpy \
#   python3 python3-pip python3-dev libtbb2 libtbb-dev \
#   libjpeg-dev libdc1394-22-dev \
#   python3-opencv libopencv-dev python3-pycurl \
#   libatlas-base-dev gfortran webp qt5-default libvtk6-dev zlib1g-dev

# RUN cd ~/ &&\
#     git clone https://github.com/Itseez/opencv.git &&\
#     git clone https://github.com/Itseez/opencv_contrib.git &&\
#     cd opencv && mkdir build && cd build && cmake  -DWITH_QT=ON -DWITH_OPENGL=ON -DFORCE_VTK=ON -DWITH_TBB=ON -DWITH_GDAL=ON -DWITH_XINE=ON -DBUILD_EXAMPLES=ON .. && \
#     make -j8 && make install && ldconfig && rm -rf ~/opencv*  # Remove the opencv folders to reduce image size

WORKDIR /app
COPY --from=git /project .
WORKDIR /app/source
RUN find | grep requirements.txt | xargs -I '{}' python3 -m pip install -r '{}' --extra-index-url https://pkgs.dev.azure.com/quix-analytics/53f7fe95-59fe-4307-b479-2473b96de6d1/_packaging/public/pypi/simple/

ENTRYPOINT python3 main.py